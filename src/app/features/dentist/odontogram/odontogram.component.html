<div class="odontogram-page">
  <h2 class="page-title">ü¶∑ {{ 'ODONTOGRAM.TITLE' | translate }}</h2>
  <!-- Patient Search -->
  <div class="patient-search-section">
    <label>{{ 'ODONTOGRAM.SELECT_PATIENT' | translate }}</label>
    <div class="search-input-wrapper">
      <input
        type="text"
        [(ngModel)]="patientSearchTerm"
        (input)="onPatientSearchInput()"
        (focus)="showPatientDropdown = true"
        [placeholder]="'ODONTOGRAM.SEARCH_PATIENT' | translate"
        class="patient-search-input"
      />
      <div class="patient-dropdown" *ngIf="showPatientDropdown && filteredPatients.length > 0">
        <div
          *ngFor="let patient of filteredPatients"
          class="patient-item"
          (click)="selectPatient(patient)"
        >
          {{ patient.firstName }} {{ patient.lastName }} - {{ patient.email }}
        </div>
      </div>
    </div>
  </div>
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>{{ 'ODONTOGRAM.LOADING' | translate }}</p>
  </div>
  <!-- Main Content (only show when patient selected) -->
  <div *ngIf="currentOdontogram && !isLoading" class="odontogram-content">
    <!-- Odontogram Info -->
    <div class="odontogram-info-wrapper">
      <div class="odontogram-info">
        <p>
          <strong>{{ 'ODONTOGRAM.PATIENT' | translate }}</strong> {{ currentOdontogram.patientName }}
          <button
            class="btn-profile-icon"
            [class.has-warning]="patientProfile?.warningSign"
            (click)="openPatientProfile()"
            [title]="'PATIENT.VIEW_PROFILE' | translate">
            üë§
          </button>
        </p>
        <p><strong>{{ 'ODONTOGRAM.CREATED' | translate }}</strong> {{ currentOdontogram.createdAt | date:'medium' }}</p>
        <p><strong>{{ 'ODONTOGRAM.LAST_UPDATED' | translate }}</strong> {{ currentOdontogram.updatedAt | date:'medium' }}</p>
      </div>
      <div class="action-buttons">
        <!-- History Button -->
        <button class="btn-history" (click)="toggleContributionHistory()">
          üìñ {{ 'ODONTOGRAM.VIEW_HISTORY' | translate }}
          <span class="history-badge" *ngIf="contributions.length > 0">{{ contributions.length }}</span>
        </button>
      </div>
    </div>
    <!-- Active Statuses Summary (Compact) -->
    <div class="active-statuses-summary" *ngIf="currentOdontogram && getActiveStatuses().length > 0">
      <div class="summary-header">
        <h4>üìä {{ 'ODONTOGRAM.STATUS_SUMMARY' | translate }}</h4>
      </div>
      <div class="status-chips">
    <span class="status-chip" *ngFor="let status of getActiveStatuses()">
      <span class="chip-dot" [style.background-color]="getStatusColor(status)"></span>
      <span class="chip-label">{{ getStatusLabel(status) }}</span>
      <span class="chip-count">({{ getStatusCount(status) }})</span>
    </span>
      </div>
      <p class="hover-hint">
        üí° {{ 'ODONTOGRAM.HOVER_INSTRUCTION' | translate }}
      </p>
    </div>
    <div class="main-layout">
      <!-- Tooth Chart -->
      <div class="tooth-chart-section">
        <h3>{{ 'ODONTOGRAM.DENTAL_CHART' | translate }}</h3>
        <!-- Upper Jaw -->
        <div class="jaw upper-jaw">
          <div class="jaw-label">{{ 'ODONTOGRAM.UPPER_JAW' | translate }}</div>
          <div class="teeth-row">
            <!-- ‚úÖ This *ngFor creates toothNum variable -->
            <div
              *ngFor="let toothNum of upperTeeth"
              class="tooth"
              [class.selected]="selectedTooth?.toothNumber === toothNum"
              (click)="selectTooth(toothNum)">
              <img
                [src]="getToothImage(toothNum)"
                [alt]="'Tooth ' + toothNum"
                class="tooth-image"
                [style.filter]="getToothFilter(toothNum)"
              />
              <span class="tooth-number">{{ toothNum }}</span>
              <!-- ‚úÖ NEW: Updated tooth surfaces with dynamic labels -->
              <div class="tooth-surfaces">
                <!-- UP = MESIAL -->
                <div
                  class="surface surface-mesial"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.MESIAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'MESIAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'UP'))">
                  {{ getSurfaceLabel(toothNum, 'UP') }}
                </div>
                <!-- DOWN = DISTAL -->
                <div
                  class="surface surface-distal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.DISTAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'DISTAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'DOWN'))">
                  {{ getSurfaceLabel(toothNum, 'DOWN') }}
                </div>
                <!-- LEFT = BUCCAL -->
                <div
                  class="surface surface-buccal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.BUCCAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'BUCCAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'LEFT'))">
                  {{ getSurfaceLabel(toothNum, 'LEFT') }}
                </div>
                <!-- RIGHT = LINGUAL -->
                <div
                  class="surface surface-lingual"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.LINGUAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'LINGUAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'RIGHT'))">
                  {{ getSurfaceLabel(toothNum, 'RIGHT') }}
                </div>
                <!-- CENTER = OCCLUSAL -->
                <div
                  class="surface surface-occlusal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.OCCLUSAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'OCCLUSAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'CENTER'))">
                  {{ getSurfaceLabel(toothNum, 'CENTER') }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Lower Jaw -->
        <div class="jaw lower-jaw">
          <div class="teeth-row">
            <!-- ‚úÖ This *ngFor creates toothNum variable -->
            <div
              *ngFor="let toothNum of lowerTeeth"
              class="tooth"
              [class.selected]="selectedTooth?.toothNumber === toothNum"
              (click)="selectTooth(toothNum)">
              <img
                [src]="getToothImage(toothNum)"
                [alt]="'Tooth ' + toothNum"
                class="tooth-image"
                [style.filter]="getToothFilter(toothNum)"
              />
              <span class="tooth-number">{{ toothNum }}</span>
              <div class="tooth-surfaces">
                <!-- UP = MESIAL -->
                <div
                  class="surface surface-mesial"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.MESIAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'MESIAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'UP'))">
                  {{ getSurfaceLabel(toothNum, 'UP') }}
                </div>
                <!-- DOWN = DISTAL -->
                <div
                  class="surface surface-distal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.DISTAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'DISTAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'DOWN'))">
                  {{ getSurfaceLabel(toothNum, 'DOWN') }}
                </div>
                <!-- LEFT = BUCCAL -->
                <div
                  class="surface surface-buccal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.BUCCAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'BUCCAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'LEFT'))">
                  {{ getSurfaceLabel(toothNum, 'LEFT') }}
                </div>
                <!-- RIGHT = LINGUAL -->
                <div
                  class="surface surface-lingual"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.LINGUAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'LINGUAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'RIGHT'))">
                  {{ getSurfaceLabel(toothNum, 'RIGHT') }}
                </div>
                <!-- CENTER = OCCLUSAL -->
                <div
                  class="surface surface-occlusal"
                  [title]="'ODONTOGRAM.SURFACE_TYPES.OCCLUSAL' | translate"
                  [style.background-color]="getSurfaceColor(toothNum, 'OCCLUSAL')"
                  (click)="onSurfaceClick($event, toothNum, getSurfaceType(toothNum, 'CENTER'))">
                  {{ getSurfaceLabel(toothNum, 'CENTER') }}
                </div>
              </div>
            </div>
          </div>
          <div class="jaw-label">{{ 'ODONTOGRAM.LOWER_JAW' | translate }}</div>
        </div>
      </div>
    </div>
  </div>
  <!-- No Patient Selected -->
  <div *ngIf="!currentOdontogram && !isLoading && selectedPatientId" class="no-data">
    <p>{{ 'ODONTOGRAM.NO_ODONTOGRAM' | translate }}</p>
  </div>
</div>

<!-- Full-Width Tooth Details Section -->
<div class="tooth-details-section" *ngIf="selectedTooth">
  <!-- Header with Close Button -->
  <div class="details-header">
    <div class="details-title">
      <h3>ü¶∑ {{ 'ODONTOGRAM.TOOTH_NUMBER' | translate }}{{ selectedTooth.toothNumber }}</h3>
      <p class="tooth-name-details">{{ getToothName(selectedTooth.toothNumber) }}</p>
    </div>
    <button class="btn-close-details" (click)="selectedTooth = null" title="Close">
      ‚úï
    </button>
  </div>
  <!-- Creator Info -->
  <div class="creator-info" *ngIf="selectedTooth.createdByOfficeName">
    <span class="info-label">{{ 'ODONTOGRAM.CREATED_AT' | translate }}</span>
    <span class="office-badge small" [style.background-color]="getOfficeBadgeColor(selectedTooth.createdByOfficeId!)">
      {{ selectedTooth.createdByOfficeName }}
    </span>
    <span class="dentist-name">{{ 'ODONTOGRAM.BY' | translate }} {{ selectedTooth.createdByDentistName }}</span>
  </div>
  <!-- Two Column Layout -->
  <div class="details-grid">
    <!-- Left Column: Status & Notes -->
    <div class="details-column">
      <h4>üìã {{ 'ODONTOGRAM.DETAILS' | translate }}</h4>
      <div class="form-group">
        <label>{{ 'ODONTOGRAM.STATUS' | translate }}</label>
        <select [(ngModel)]="selectedTooth.status" class="details-select">
          <option *ngFor="let status of toothStatuses" [value]="status">
            {{ getStatusLabel(status) }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>{{ 'ODONTOGRAM.NOTES' | translate }}</label>
        <textarea
          [(ngModel)]="selectedTooth.notes"
          rows="4"
          class="details-textarea"
          [placeholder]="'ODONTOGRAM.NOTES' | translate">
        </textarea>
      </div>
      <button class="btn-primary btn-full" (click)="updateToothStatus()">
        {{ 'ODONTOGRAM.SAVE_CHANGES' | translate }}
      </button>
    </div>
    <!-- Right Column: Treatment Plans -->
    <div class="details-column">
      <h4>üíä {{ 'ODONTOGRAM.TREATMENT_PLANS' | translate }}</h4>
      <div *ngIf="selectedTooth.treatmentPlans.length === 0" class="no-treatments-inline">
        <p>{{ 'ODONTOGRAM.NO_TREATMENTS' | translate }}</p>
      </div>
      <div class="treatments-list">
        <div *ngFor="let treatment of selectedTooth.treatmentPlans" class="treatment-card">
          <div class="treatment-card-header">
            <strong>{{ treatment.treatmentType }}</strong>
            <span
              *ngIf="treatment.createdByOfficeName"
              class="office-badge tiny"
              [style.background-color]="getOfficeBadgeColor(treatment.createdByOfficeId!)"
              [title]="('ODONTOGRAM.CREATED_AT' | translate) + ' ' + treatment.createdByOfficeName">
              {{ treatment.createdByOfficeName }}
            </span>
          </div>
          <div class="treatment-card-body">
            <p *ngIf="treatment.serviceName" class="treatment-info">
              <span class="info-icon">ü¶∑</span> {{ treatment.serviceName }}
            </p>
            <p *ngIf="treatment.plannedDate" class="treatment-info">
              <span class="info-icon">üìÖ</span> {{ treatment.plannedDate | date:'mediumDate' }}
            </p>
            <p *ngIf="treatment.estimatedCost" class="treatment-info">
              <span class="info-icon">üí∞</span> {{ treatment.estimatedCost | currency:'RSD' }}
            </p>
            <p *ngIf="treatment.notes" class="treatment-info">
              <span class="info-icon">üìù</span> {{ treatment.notes }}
            </p>
          </div>
          <div class="treatment-card-footer">
            <span [class]="'status-badge status-' + treatment.status.toLowerCase()">
              {{ "ODONTOGRAM." + treatment.status | translate }}
            </span>
            <div class="treatment-actions-inline" *ngIf="treatment.status === 'PLANNED'">
              <button class="btn-small btn-complete" (click)="updateTreatmentStatus(treatment, 'COMPLETED')">
                {{ 'ODONTOGRAM.COMPLETE' | translate }}
              </button>
              <button class="btn-small btn-cancel" (click)="updateTreatmentStatus(treatment, 'CANCELLED')">
                {{ 'ODONTOGRAM.CANCEL' | translate }}
              </button>
            </div>
            <div class="treatment-actions-inline" *ngIf="treatment.status === 'IN_PROGRESS'">
              <button class="btn-small btn-complete" (click)="updateTreatmentStatus(treatment, 'COMPLETED')">
                {{ 'ODONTOGRAM.COMPLETE' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
      <button class="btn-secondary btn-full" (click)="openTreatmentDialog()">
        {{ 'ODONTOGRAM.ADD_TREATMENT_PLAN' | translate }}
      </button>
    </div>
  </div>
</div>
<!-- Treatment Dialog Modal -->
<div *ngIf="showTreatmentDialog" class="modal-overlay" (click)="closeTreatmentDialog()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>{{ 'ODONTOGRAM.ADD_TREATMENT_TITLE' | translate }}{{ treatmentForm.toothNumber }}</h3>
    <form (ngSubmit)="addTreatment()">
      <label>{{ 'ODONTOGRAM.TREATMENT_TYPE' | translate }}</label>
      <input type="text" [(ngModel)]="treatmentForm.treatmentType" name="treatmentType" required [placeholder]="'ODONTOGRAM.TREATMENT_TYPE_PLACEHOLDER' | translate">
      <label>{{ 'ODONTOGRAM.SELECT_SERVICE' | translate }}</label>
      <div class="service-search-wrapper">
        <input
          type="text"
          [(ngModel)]="serviceSearchTerm"
          (input)="onServiceSearchInput()"
          (focus)="showServiceDropdown = true"
          [placeholder]="'ODONTOGRAM.SEARCH_SERVICE_PLACEHOLDER' | translate"
          class="service-search-input"
          name="serviceSearch"
        />
        <!-- Clear button -->
        <button
          type="button"
          *ngIf="serviceSearchTerm"
          class="clear-service-btn"
          (click)="clearServiceSelection()"
          title="Clear">
          ‚úï
        </button>
        <!-- Service Dropdown -->
        <div
          class="service-dropdown"
          *ngIf="showServiceDropdown && filteredServices.length > 0"
          (click)="$event.stopPropagation()">
          <div
            *ngFor="let service of filteredServices"
            class="service-item"
            (click)="selectService(service)">
            <span class="service-name">{{ "SERVICE_ID." + service.service.id | translate }}</span>
            <span class="service-price" *ngIf="service.price">{{ service.price | currency:'RSD' }}</span>
          </div>
        </div>
        <!-- No results message -->
        <div
          class="service-dropdown no-results"
          *ngIf="showServiceDropdown && filteredServices.length === 0">
          <p>{{ 'ODONTOGRAM.NO_SERVICES_FOUND' | translate }}</p>
        </div>
      </div>
      <label>{{ 'ODONTOGRAM.PLANNED_DATE' | translate }}</label>
      <input type="date" [(ngModel)]="treatmentForm.plannedDate" name="plannedDate">
      <label>{{ 'ODONTOGRAM.ESTIMATED_COST' | translate }}</label>
      <input type="number" [(ngModel)]="treatmentForm.estimatedCost" name="estimatedCost" placeholder="0.00">
      <label>{{ 'ODONTOGRAM.TREATMENT_NOTES' | translate }}</label>
      <textarea [(ngModel)]="treatmentForm.notes" name="notes" rows="3" [placeholder]="'ODONTOGRAM.TREATMENT_NOTES_PLACEHOLDER' | translate"></textarea>
      <div class="modal-actions">
        <button type="submit" class="btn-primary">{{ 'ODONTOGRAM.ADD_TREATMENT' | translate }}</button>
        <button type="button" class="btn-secondary" (click)="closeTreatmentDialog()">{{ 'ODONTOGRAM.CANCEL_ACTION' | translate }}</button>
      </div>
    </form>
  </div>
</div>
<!-- Surface Edit Dialog -->
<div *ngIf="showSurfaceDialog" class="modal-overlay" (click)="closeSurfaceDialog()">
  <div class="modal-content surface-modal" (click)="$event.stopPropagation()">
    <h3>{{ 'ODONTOGRAM.EDIT_SURFACE' | translate }} {{ getSurfaceTypeLabel(selectedSurface?.surfaceType || 'OCCLUSAL') }}</h3>
    <p class="surface-info">{{ 'ODONTOGRAM.TOOTH_NUMBER' | translate }}{{ selectedTooth?.toothNumber }} - {{ getToothName(selectedTooth?.toothNumber || '') }}</p>
    <div class="surface-form" *ngIf="selectedSurface">
      <label>{{ 'ODONTOGRAM.SURFACE_STATUSS' | translate }}</label>
      <select [(ngModel)]="selectedSurface.status" class="surface-status-select">
        <option *ngFor="let status of surfaceStatuses" [value]="status">
          {{ getSurfaceStatusLabel(status) }}
        </option>
      </select>
      <label>{{ 'ODONTOGRAM.SURFACE_NOTES' | translate }}</label>
      <textarea
        [(ngModel)]="selectedSurface.notes"
        rows="3"
        [placeholder]="'ODONTOGRAM.SURFACE_NOTES_PLACEHOLDER' | translate">
      </textarea>
      <!-- Surface Status Preview -->
      <div class="surface-preview">
        <div
          class="preview-box"
          [style.background-color]="getSurfaceColor(selectedTooth?.toothNumber || '', selectedSurface.surfaceType)">
          {{ selectedSurface.surfaceType.charAt(0) }}
        </div>
        <span>{{ 'ODONTOGRAM.PREVIEW' | translate }} {{ getSurfaceStatusLabel(selectedSurface.status) }}</span>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-primary" (click)="updateSurfaceStatus()">{{ 'ODONTOGRAM.SAVE_SURFACE' | translate }}</button>
        <button type="button" class="btn-secondary" (click)="closeSurfaceDialog()">{{ 'ODONTOGRAM.CANCEL_ACTION' | translate }}</button>
      </div>
    </div>
  </div>
</div>
<!-- Contribution History Modal -->
<div *ngIf="showContributionHistory" class="modal-overlay" (click)="toggleContributionHistory()">
  <div class="modal-content history-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üïê {{ 'ODONTOGRAM.RECORD_HISTORY' | translate }}</h3>
      <button class="close-button" (click)="toggleContributionHistory()" title="Close">‚úï</button>
    </div>
    <p class="history-subtitle">{{ 'ODONTOGRAM.CONTRIBUTION_HISTORY_SUBTITLE' | translate }}</p>
    <div *ngIf="contributions.length === 0" class="no-contributions">
      <p>{{ 'ODONTOGRAM.NO_HISTORY' | translate }}</p>
    </div>
    <div *ngIf="contributions.length > 0" class="timeline">
      <div *ngFor="let contribution of contributions" class="timeline-item">
        <div class="timeline-content">
          <div class="contribution-header">
            <span class="office-badge" [style.background-color]="getOfficeBadgeColor(contribution.officeId)">
              {{ contribution.officeName }}
            </span>
            <span class="contribution-date">{{ contribution.contributionDate | date:'medium' }}</span>
          </div>
          <div class="contribution-body">
            <strong>{{ contribution.dentistName }}</strong>
            <span class="action-type">{{ 'ODONTOGRAM.ACTION_TYPES.' + contribution.actionType | translate }}</span>
          </div>
          <p class="contribution-description">{{ getTranslatedDescription(contribution) }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Patient Profile Modal -->
<div *ngIf="showPatientProfileDialog" class="modal-overlay" (click)="closePatientProfile()">
  <div class="modal-content profile-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üë§ {{ 'PATIENT.PROFILE_TITLE' | translate }}</h3>
      <button class="close-button" (click)="closePatientProfile()" title="Close">‚úï</button>
    </div>
    <!-- Loading State -->
    <div *ngIf="!patientProfile" class="profile-loading">
      <p>{{ 'PATIENT.LOADING_PROFILE' | translate }}</p>
    </div>
    <!-- Profile Content -->
    <div *ngIf="patientProfile" class="profile-content">
      <div *ngIf="patientProfile.warningSign" class="warning-banner">
        ‚ö†Ô∏è <strong>{{ 'PATIENT.WARNING' | translate }}:</strong> {{ patientProfile.warningDescription }}
      </div>
      <div class="profile-sections-container">
        <!-- Left Column: Personal Information -->
        <div class="profile-section personal-section">
          <h4>üìã {{ 'PATIENT.PERSONAL_INFO' | translate }}</h4>
          <div class="form-grid-single">
            <div class="form-field">
              <label>{{ 'PATIENT.FIRST_NAME' | translate }} <span class="required">*</span></label>
              <input
                type="text"
                [(ngModel)]="patientProfile.firstName"
                class="profile-input"
                required
                [placeholder]="'PATIENT.FIRST_NAME_PLACEHOLDER' | translate"
              />
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.LAST_NAME' | translate }} <span class="required">*</span></label>
              <input
                type="text"
                [(ngModel)]="patientProfile.lastName"
                class="profile-input"
                required
                [placeholder]="'PATIENT.LAST_NAME_PLACEHOLDER' | translate"
              />
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.EMAIL' | translate }}</label>
              <input
                type="email"
                [(ngModel)]="patientProfile.email"
                class="profile-input"
                [placeholder]="'PATIENT.EMAIL_PLACEHOLDER' | translate"
              />
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.PHONE' | translate }} <span class="required">*</span></label>
              <input
                type="tel"
                [(ngModel)]="patientProfile.phoneNumber"
                class="profile-input"
                required
                [placeholder]="'PATIENT.PHONE_PLACEHOLDER' | translate"
              />
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.BIRTH_DATE' | translate }} <span class="required">*</span></label>
              <input
                type="date"
                [(ngModel)]="patientProfile.birthDate"
                class="profile-input"
                required
              />
              <small class="age-display" *ngIf="patientProfile.birthDate">
                {{ 'PATIENT.AGE' | translate }}: {{ calculateAge(patientProfile.birthDate) }} {{ 'PATIENT.YEARS' | translate }}
              </small>
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.ADDRESS' | translate }}</label>
              <input
                type="text"
                [(ngModel)]="patientProfile.address"
                class="profile-input"
                [placeholder]="'PATIENT.ADDRESS_PLACEHOLDER' | translate"
              />
            </div>
            <div class="form-field">
              <label>{{ 'PATIENT.OCCUPATION' | translate }}</label>
              <input
                type="text"
                [(ngModel)]="patientProfile.occupation"
                class="profile-input"
                [placeholder]="'PATIENT.OCCUPATION_PLACEHOLDER' | translate"
              />
            </div>
          </div>
        </div>
        <!-- Right Column: Clinical Information -->
        <div class="profile-section clinical-section">
          <h4>üè• {{ 'PATIENT.CLINICAL_INFO' | translate }}</h4>
          <div class="form-grid-single">
            <div class="form-field">
              <label>{{ 'PATIENT.GENERAL_NOTES' | translate }}</label>
              <textarea
                [(ngModel)]="patientProfile.generalNotes"
                rows="10"
                class="profile-textarea"
                [placeholder]="'PATIENT.NOTES_PLACEHOLDER' | translate">
              </textarea>
              <small class="field-hint">{{ 'PATIENT.NOTES_HINT' | translate }}</small>
            </div>
            <div class="warning-section">
              <div class="form-field checkbox-field">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    [(ngModel)]="patientProfile.warningSign"
                  />
                  <span>‚ö†Ô∏è {{ 'PATIENT.WARNING_SIGN' | translate }}</span>
                </label>
              </div>
              <div class="form-field" *ngIf="patientProfile.warningSign">
                <label>{{ 'PATIENT.WARNING_DESCRIPTION' | translate }} <span class="required">*</span></label>
                <input
                  type="text"
                  [(ngModel)]="patientProfile.warningDescription"
                  class="profile-input warning-input"
                  [placeholder]="'PATIENT.WARNING_PLACEHOLDER' | translate"
                  required
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="profile-actions">
        <button class="btn-save-profile" (click)="savePatientProfile()">
          {{ 'PATIENT.SAVE_PROFILE' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
